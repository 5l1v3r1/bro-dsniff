refine flow POPPASSD_Flow += {

%member{
   	StringVal* username;
       	StringVal* password;
	StringVal* newpassword;
%}


	function proc_poppassd_username(msg: USERNAME_PDU): bool
		%{
		username =  new StringVal(${msg.username}.length(),(const char*)${msg.username}.begin());
		return true;
		%}


	function proc_poppassd_oldpassword(msg: OLDPASSWORD_PDU): bool
		%{
		password = new StringVal(${msg.password}.length(),(const char*)${msg.password}.begin());
		return true;
		%}
	
	
	function proc_poppassd_password(msg: PASSWORD_PDU): bool
		%{
		newpassword = new StringVal(${msg.newpassword}.length(),(const char*)${msg.newpassword}.begin());
		BifEvent::generate_poppassd_event(connection()->bro_analyzer(), connection()->bro_analyzer()->Conn() ,
		username,
		password,
		newpassword
		);
		return true;
		%}

	function proc_poppassd(msg: POPPASSD_PDU): bool
		%{
		BifEvent::generate_poppassd_debug(connection()->bro_analyzer(), connection()->bro_analyzer()->Conn() ,
		new StringVal(${msg.restofdata}.length(),(const char*)${msg.restofdata}.begin())
		);
		return true;
		%}

};
	

refine typeattr POPPASSD_PDU += &let {
	proc: bool = $context.flow.proc_poppassd(this);
};

refine typeattr USERNAME_PDU += &let {
	proc: bool = $context.flow.proc_poppassd_username(this);
};


refine typeattr OLDPASSWORD_PDU += &let {
	proc: bool = $context.flow.proc_poppassd_oldpassword(this);
};


refine typeattr PASSWORD_PDU += &let {
	proc: bool = $context.flow.proc_poppassd_password(this);
};